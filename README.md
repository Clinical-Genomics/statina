# NIPTool  [![Coverage Status](https://coveralls.io/repos/github/Clinical-Genomics/NIPTool/badge.svg?branch=master)](https://coveralls.io/github/Clinical-Genomics/NIPTool?branch=master) [![Build Status](https://travis-ci.org/Clinical-Genomics/NIPTool.svg?branch=master)](https://travis-ci.org/Clinical-Genomics/NIPTool) ![Latest Release](https://img.shields.io/github/v/release/clinical-genomics/NIPTool)


NIPTool is a visualisation tool for the data produced by the [Fluffy] pipeline running [WisecondorX] to analyze NIPT.

## Installation

```bash
git clone https://github.com/Clinical-Genomics/NIPTool
cd NIPTool
pip install -r requirements.txt -e .
```

## Usage

### Demo

Once installed, you can set up NIPTool by running a few commands using the included command line interface. 
Given you have a MongoDB server listening on the default port (27017), this is how you would set up a fully working 
NIPTool demo:

```bash
nipt load batch --result-file NIPTool/tests/fixtures/valid_fluffy.csv
```

Settings can be used by exporting the environment variables: `DB_NAME`, `DB_URI`, `HOST`, `PORT`
This will set up an instance of NIPTool with a database called `nipt-demo`. Now run

```bash
nipt serve --reload
```
 and play around with the interface.

### Docker image

NIPTool can also run as a container. The image is available [on Docker Hub][docker-hub] or can be build using the 
Dockerfile provided in this repository.

To build a new image from the Dockerfile use the commands: `docker build -t niptool .`

To run the image use the following command: `docker run --name niptool niptool nipt `

To remove the container, type: `docker rm niptool`

## Release model
NIPTool development is organised on a flexible Git "Release Flow" branching system. This more or less means that we 
make releases in release branches which corresponds to stable versions of NIPTool.

### Steps to make a new release:

1) Create a release branch from master named `version_X.X.X`
2) Update change log with the new version.
3) Update NIPTool/__init__.py with the new version.
4) Make a PR to master,
	- Name PR `release version X.X.X`
	- Justify if its a patch/minor/major version bump
	- Paste the latest changelog to the text body
	- get it approved and merge to master. **Dont delete the release branch!**
5) Make a [new release](https://github.com/Clinical-Genomics/NIPTool/releases/new).
	- Name tag version as `vX.X.X`
	- Set target to the release branch
	- Make descriptive title
	- Paste latest changelog to the text body
	- Release!

### Deploying to production

Use `update-nipt-prod.sh` script to update production both on Hasta and clinical-db. 
**Please follow the development guide and `servers` repo when doing so. It is also important to keep those involved informed.**

## Back End
The NIPT database is a Mongo database consisting of following collections:

- **batch** - holds batch level information.
- **sample** - holds sample level information.
- **user** - holds user names, emails and roles.

The database is loaded through the CLI with data generated by the [FluFFyPipe][Fluffy]


[Fluffy]: https://github.com/Clinical-Genomics/fluffy
[WisecondorX]: https://github.com/CenterForMedicalGeneticsGhent/WisecondorX
[docker-hub]: https://hub.docker.com/repository/docker/clinicalgenomics/niptool